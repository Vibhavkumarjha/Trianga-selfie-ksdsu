<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Selfie Poster Generator</title>
  <style>
    :root{
      --bg:#0f172a; /* slate-900 */
      --card:#111827; /* gray-900 */
      --muted:#94a3b8; /* slate-400 */
      --accent:#16a34a; /* green-600 */
      --ring:#22c55e; /* green-500 */
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,"Noto Sans","Apple Color Emoji","Segoe UI Emoji";background:var(--bg);color:#e5e7eb;}
    .wrap{max-width:1100px;margin:24px auto;padding:16px}
    .card{background:var(--card);border:1px solid #1f2937;border-radius:20px;box-shadow:0 10px 25px rgba(0,0,0,.35);}
    .header{padding:18px 20px;border-bottom:1px solid #1f2937;display:flex;gap:14px;align-items:center}
    .header h1{font-size:20px;margin:0;font-weight:700}
    .grid{display:grid;grid-template-columns:1fr;gap:16px;padding:16px}
    @media(min-width:900px){.grid{grid-template-columns:360px 1fr}}
    .pane{padding:16px;border:1px dashed #374151;border-radius:16px}
    label{display:block;font-size:13px;color:var(--muted);margin:10px 0 6px}
    input[type="file"],input[type="text"],input[type="number"]{width:100%;padding:10px;border-radius:12px;border:1px solid #374151;background:#0b1220;color:#e5e7eb;outline:none}
    input:focus{border-color:var(--ring);box-shadow:0 0 0 3px rgba(34,197,94,.15)}
    .row{display:flex;gap:8px}
    .row > *{flex:1}
    button{appearance:none;border:0;background:var(--accent);color:white;padding:12px 14px;border-radius:14px;font-weight:700;cursor:pointer}
    button.secondary{background:#334155}
    button:disabled{opacity:.6;cursor:not-allowed}
    .help{font-size:12px;color:var(--muted)}
    canvas{width:100%;height:auto;background:#000;border-radius:16px}
    .preview{position:relative}
    .hint{position:absolute;inset:auto 16px 16px auto;background:rgba(0,0,0,.6);padding:6px 10px;border-radius:999px;font-size:12px}
    .footer{padding:14px 16px;border-top:1px solid #1f2937;display:flex;gap:10px;flex-wrap:wrap}
    .badge{font-size:12px;color:#9ca3af}
    .warn{color:#fbbf24}
    details{border:1px dashed #374151;border-radius:12px;padding:10px}
    summary{cursor:pointer;color:#cbd5e1}
    .small{font-size:12px;color:#a3a3a3}
  </style>
</head>
<body>
  <div class="wrap card">
    <div class="header">
      <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4 5a2 2 0 0 1 2-2h6.5a2 2 0 0 1 1.6.8l1.75 2.4a2 2 0 0 0 1.6.8H18a2 2 0 0 1 2 2V19a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V5Z" stroke="#22c55e" stroke-width="1.4"/><path d="M7 15.5c1.3-1.8 2.7-2.7 4.2-2.7 1.6 0 2.7.9 3.8 2.4 1-.9 1.9-1.3 3-1.3 1 0 1.9.3 3 .9" stroke="#22c55e" stroke-width="1.4" stroke-linecap="round"/></svg>
      <h1>Selfie Poster Generator</h1>
    </div>

    <div class="grid">
      <!-- LEFT: Controls -->
      <div class="pane">
        <label>1) Upload your frame image <span class="small">(PNG/JPG). Name it <b>frame.jpg</b> if you will host the file with this page.</span></label>
        <input id="frameInput" type="file" accept="image/*" />
        <div class="help">If you already have the poster frame on your server, you can set its URL in the <i>Frame URL</i> box below.</div>

        <label>or Frame URL (optional)</label>
        <input id="frameURL" type="text" placeholder="/assets/frame.jpg" />

        <label>2) Upload user photo</label>
        <input id="photoInput" type="file" accept="image/*" />

        <label>3) White-box position <span class="small">(percent of frame; adjust if needed)</span></label>
        <div class="row">
          <div>
            <label>Left (%)</label>
            <input id="bx" type="number" step="0.1" value="30.16"/>
          </div>
          <div>
            <label>Top (%)</label>
            <input id="by" type="number" step="0.1" value="34.96"/>
          </div>
        </div>
        <div class="row">
          <div>
            <label>Width (%)</label>
            <input id="bw" type="number" step="0.1" value="39.68"/>
          </div>
          <div>
            <label>Height (%)</label>
            <input id="bh" type="number" step="0.1" value="31.79"/>
          </div>
        </div>
        <label>Corner radius (px)</label>
        <input id="radius" type="number" step="1" value="36"/>
        <div class="help">Defaults above match the white box in the sample poster you shared.</div>

        <div style="height:8px"></div>
        <button id="genBtn" disabled>Generate Poster</button>
        <button id="dlBtn" class="secondary" disabled>Download PNG</button>
        <div class="help" style="margin-top:8px">Tip: after you host this page at your own URL, visitors can upload their selfie and instantly get the poster image.</div>
      </div>

      <!-- RIGHT: Preview -->
      <div class="pane preview">
        <canvas id="canvas"></canvas>
        <div class="hint">Live preview</div>
        <details style="margin-top:12px">
          <summary>How to deploy this</summary>
          <div class="help" style="margin-top:8px">
            1) Put this <b>index.html</b> on your hosting (GitHub Pages, Netlify, Vercel, or your own domain).<br/>
            2) Upload your poster frame image to the same folder (e.g., <code>frame.jpg</code>) and set its URL above (or hard-code it in the script).<br/>
            3) Share your URL. The app runs fully in the browserâ€”no server needed unless you want to save data.
          </div>
        </details>
      </div>
    </div>

    <div class="footer">
      <span class="badge">No data uploaded to any server unless you add your own backend.</span>
      <span class="badge warn">If your frame size changes, just tweak the % values for perfect alignment.</span>
    </div>
  </div>

  <script>
    const frameInput = document.getElementById('frameInput');
    const frameURL   = document.getElementById('frameURL');
    const photoInput = document.getElementById('photoInput');
    const genBtn     = document.getElementById('genBtn');
    const dlBtn      = document.getElementById('dlBtn');

    const bx = document.getElementById('bx');
    const by = document.getElementById('by');
    const bw = document.getElementById('bw');
    const bh = document.getElementById('bh');
    const radius = document.getElementById('radius');

    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');

    let frameImg = new Image();
    let userImg  = new Image();

    function setButtons(){
      genBtn.disabled = !(frameImg.complete && frameImg.src && (userImg.complete && userImg.src));
      dlBtn.disabled = true;
    }

    function loadFileToImage(file, targetImg){
      return new Promise((resolve, reject)=>{
        if(!file) return reject('No file');
        const reader = new FileReader();
        reader.onload = e => { targetImg.src = e.target.result; };
        reader.onerror = reject;
        targetImg.onload = ()=> resolve();
        targetImg.onerror = reject;
        reader.readAsDataURL(file);
      });
    }

    function loadURLToImage(url, targetImg){
      return new Promise((resolve, reject)=>{
        if(!url) return reject('No URL');
        targetImg.crossOrigin = 'anonymous';
        targetImg.onload = ()=> resolve();
        targetImg.onerror = reject;
        targetImg.src = url;
      });
    }

    // Rounded-rect path helper
    function roundRectPath(x, y, w, h, r){
      r = Math.min(r, w/2, h/2);
      ctx.beginPath();
      ctx.moveTo(x+r, y);
      ctx.lineTo(x+w-r, y);
      ctx.quadraticCurveTo(x+w, y, x+w, y+r);
      ctx.lineTo(x+w, y+h-r);
      ctx.quadraticCurveTo(x+w, y+h, x+w-r, y+h);
      ctx.lineTo(x+r, y+h);
      ctx.quadraticCurveTo(x, y+h, x, y+h-r);
      ctx.lineTo(x, y+r);
      ctx.quadraticCurveTo(x, y, x+r, y);
      ctx.closePath();
    }

    function draw(){
      if(!frameImg || !frameImg.complete) return;
      const W = frameImg.naturalWidth; // keep full resolution
      const H = frameImg.naturalHeight;
      canvas.width = W;
      canvas.height = H;

      // draw frame
      ctx.clearRect(0,0,W,H);
      ctx.drawImage(frameImg, 0, 0, W, H);

      if(userImg && userImg.complete){
        const px = (parseFloat(bx.value) / 100) * W;
        const py = (parseFloat(by.value) / 100) * H;
        const pw = (parseFloat(bw.value) / 100) * W;
        const ph = (parseFloat(bh.value) / 100) * H;

        // fit user image to the box (cover)
        const iw = userImg.naturalWidth;
        const ih = userImg.naturalHeight;
        const boxRatio = pw / ph;
        const imgRatio = iw / ih;
        let sw, sh, sx, sy; // source crop in user image
        if(imgRatio > boxRatio){
          // image is wider -> crop sides
          sh = ih;
          sw = ih * boxRatio;
          sx = (iw - sw) / 2;
          sy = 0;
        } else {
          // image is taller -> crop top/bottom
          sw = iw;
          sh = iw / boxRatio;
          sx = 0;
          sy = (ih - sh) / 2;
        }

        // mask rounded rectangle then draw
        ctx.save();
        roundRectPath(px, py, pw, ph, parseFloat(radius.value||0));
        ctx.clip();
        ctx.drawImage(userImg, sx, sy, sw, sh, px, py, pw, ph);
        ctx.restore();
      }
    }

    function enableDownload(){
      const url = canvas.toDataURL('image/png');
      const a = document.createElement('a');
      a.href = url;
      a.download = 'poster.png';
      // Prepare the same URL for the visible button
      dlBtn.onclick = ()=> a.click();
      dlBtn.disabled = false;
    }

    frameInput.addEventListener('change', async (e)=>{
      try{ await loadFileToImage(e.target.files[0], frameImg); draw(); setButtons(); }
      catch(err){ alert('Could not load frame: '+err); }
    });

    frameURL.addEventListener('change', async (e)=>{
      const url = e.target.value.trim();
      if(!url) return;
      try{ await loadURLToImage(url, frameImg); draw(); setButtons(); }
      catch(err){ alert('Frame URL failed: '+err); }
    });

    photoInput.addEventListener('change', async (e)=>{
      try{ await loadFileToImage(e.target.files[0], userImg); draw(); setButtons(); }
      catch(err){ alert('Could not load photo: '+err); }
    });

    genBtn.addEventListener('click', ()=>{ draw(); enableDownload(); });

    // If you want to hard-code your frame (recommended for live URL),
    // set it here and comment out the line below.
    // Example: frameImg.src = 'https://yourdomain.com/path/to/frame.jpg';

    // Live preview re-draw when numbers change
    [bx,by,bw,bh,radius].forEach(inp=> inp.addEventListener('input', draw));

    // Optional: try to auto-load a local frame named frame.jpg in same folder
    (function tryAutoload(){
      const url = 'frame.jpg';
      frameURL.value = 'frame.jpg';
      loadURLToImage(url, frameImg).then(()=>{ draw(); setButtons(); }).catch(()=>{});
    })();
  </script>
</body>
</html>
